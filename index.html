<!DOCTYPE html>
<html>
  <head>
    <title>MiniSearch Примерд22</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
   <script src="https://cdn.jsdelivr.net/npm/minisearch@7.1.0/dist/umd/index.min.js"></script>
<link rel="shortcut icon" href="#">
    <style>
        #results {
            list-style: none;
            padding: 0;
        }
        #results li {
            margin-bottom: 5px;
        }
        #suggestions {
          list-style: none;
          padding: 0;
        }
        #suggestions li {
          margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <input type="text" class="Search" placeholder="Search...">
     <ul id="suggestions"></ul>
    <ul id="results"></ul>
      <script  type="text/javascript">
      const $searchInput = document.querySelector(".Search");
      const $results = document.getElementById("results");
      const $suggestions = document.getElementById("suggestions");

      var arr = [{
          "id": 123456, "p": [{
            "b": {
              "span": {
                "id": 0,
                "@style": "color:black; font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: x-large;",
                "#text": "Руководство пользователя по работе в Личном кабинете (ЛК)"
              }
            }
          },
          {
            "@style": "border:none;mso-border-bottom-alt:solid windowtext .75pt;padding:0cm;mso-padding-alt:0cm 0cm 12.0pt 0cm",
            "@class": "MsoNormal",
            "a": {
              "@href": "javascript:void(scrollIntoView(#top))",
              "strong": {
                "span": {
                  "id": 1,
                  "@style": "font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: large;",
                  "#text": "1. Первичный вход в личный кабинет"
                }
              }
            }
          },
          {
            "a": {
              "@href": "javascript:void(scrollIntoView(#top1))",
              "strong": {
                "span": {
                  "id": 2,
                  "@style": "font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: large;",
                  "#text": "2. Настройка ЭЦП"
                }
              }
            }
          },
          {
            "a": {
              "@href": "javascript:void(scrollIntoView(#top2))",
              "strong": {
                "span": {
                  "id": 3,
                  "@style": "font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: large;",
                  "#text": "3. Работа с поручениями в ЛК"
                }
              }
            }
          }]
        }];

        const flattenedData = arr.flatMap(item => {
          const flattenedItems = [];
          if (item.p && item.p[0]?.b?.span?.['#text']) {
            flattenedItems.push({
              ...item,
              id: item.id + '_0',
                text: item.p[0].b.span['#text'],
              html: `<p><span style="${item.p[0].b.span["@style"]}">${item.p[0].b.span['#text']}</span></p>`,
              textIndex: 0
            });
          }
           if(item.p && item.p[1]?.a?.strong?.span?.['#text']){
            flattenedItems.push({
                ...item,
                id: item.id + '_1',
              text: item.p[1].a.strong.span['#text'],
              html: `<p><a href="${item.p[1].a["@href"]}"><strong ><span style="${item.p[1].a.strong.span["@style"]}">${item.p[1].a.strong.span['#text']}</span></strong></a></p>`,
                textIndex:1
            });
           }
           if(item.p && item.p[2]?.a?.strong?.span?.['#text']){
               flattenedItems.push({
                ...item,
                id: item.id + '_2',
                 text: item.p[2].a.strong.span['#text'],
                html: `<p><a href="${item.p[2].a["@href"]}"><strong ><span style="${item.p[2].a.strong.span["@style"]}">${item.p[2].a.strong.span['#text']}</span></strong></a></p>`,
                textIndex:2
           });
        }
         if(item.p && item.p[3]?.a?.strong?.span?.['#text']){
             flattenedItems.push({
                ...item,
                 id: item.id + '_3',
                text: item.p[3].a.strong.span['#text'],
                html: `<p><a href="${item.p[3].a["@href"]}"><strong ><span style="${item.p[3].a.strong.span["@style"]}">${item.p[3].a.strong.span['#text']}</span></strong></a></p>`,
               textIndex:3
           });
        }
        return flattenedItems;
       });

        let miniSearch = new MiniSearch({
          fields: ["text"],
             storeFields: ["html", "textIndex"]
        });

        miniSearch.addAll(flattenedData);

        $searchInput.addEventListener("input", (event) => {
          const query = $searchInput.value;
          const results = (query.length > 0) ? getSearchResults(query) : [];
          renderSearchResults(results);
          const suggestions = (query.length > 0) ? getSuggestions(query) : [];
          renderSuggestions(suggestions);
        });

        const getSearchResults = (query) => {
             return miniSearch.search(query);
        };

          const getSuggestions = (query) => {
            return miniSearch.autoSuggest(query, { boost: { "text": 5 } });
          };


      const renderSearchResults = (results) => {
        $results.innerHTML = "";
        results.forEach(result => {
            const li = document.createElement('li');
           li.innerHTML = result.html;
           $results.appendChild(li);
         });
        };
          const renderSuggestions = (suggestions) => {
            $suggestions.innerHTML = "";
            suggestions.forEach(suggestion => {
                const li = document.createElement('li');
                li.textContent = suggestion.suggestion;
                $suggestions.appendChild(li);
            });
        };
    </script>
</body>
</html>
