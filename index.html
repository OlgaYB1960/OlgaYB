<!DOCTYPE html>
<html>
  <head>
    <title>MiniSearch Примерддд</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
   <script src="https://cdn.jsdelivr.net/npm/minisearch@7.1.0/dist/umd/index.min.js"></script>
<link rel="shortcut icon" href="#">
    <style>
        #results {
            list-style: none;
            padding: 0;
        }
        #results li {
            margin-bottom: 5px;
        }
        #suggestions {
          list-style: none;
          padding: 0;
        }
        #suggestions li {
          margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <input type="text" class="Search" placeholder="Search...">
     <ul id="suggestions"></ul>
    <ul id="results"></ul>
   <script  type="text/javascript">

      const $searchInput = document.querySelector(".Search");
      const $results = document.getElementById("results");
      const $suggestions = document.getElementById("suggestions");

      var arr = [{
          "id": 123456, "p": [{
            "b": {
              "span": {
                "id": 0,
                "@style": "color:black; font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: x-large;",
                "#text": "Руководство пользователя по работе в Личном кабинете (ЛК)"
              }
            }
          },
          {
            "@style": "border:none;mso-border-bottom-alt:solid windowtext .75pt;padding:0cm;mso-padding-alt:0cm 0cm 12.0pt 0cm",
            "@class": "MsoNormal",
            "a": {
              "@href": "javascript:void(scrollIntoView(#top))",
              "strong": {
                "span": {
                  "id": 1,
                  "@style": "font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: large;",
                  "#text": "1. Первичный вход в личный кабинет"
                }
              }
            }
          },
          {
            "a": {
              "@href": "javascript:void(scrollIntoView(#top1))",
              "strong": {
                "span": {
                  "id": 2,
                  "@style": "font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: large;",
                  "#text": "2. Настройка ЭЦП"
                }
              }
            }
          },
          {
            "a": {
              "@href": "javascript:void(scrollIntoView(#top2))",
              "strong": {
                "span": {
                  "id": 3,
                  "@style": "font-family: TimesNewRoman,&quot;Times New Roman&quot;,Times,Baskerville,Georgia,serif; font-size: large;",
                  "#text": "3. Работа с поручениями в ЛК"
                }
              }
            }
          }]
        }];

       const flattenedData = arr.map(item => {
          const flattenedItem = { ...item,
               text0: item.p[0]?.b?.span?.['#text'] ? { text: item.p[0]?.b?.span?.['#text'], index: 0} : null,
               text1: item.p[1]?.a?.strong?.span?.['#text'] ? { text: item.p[1]?.a?.strong?.span?.['#text'], index: 1 } : null,
               text2: item.p[2]?.a?.strong?.span?.['#text'] ? { text: item.p[2]?.a?.strong?.span?.['#text'], index: 2 } : null,
               text3: item.p[3]?.a?.strong?.span?.['#text'] ? { text: item.p[3]?.a?.strong?.span?.['#text'], index: 3 }: null
            };
           return flattenedItem;
         });

         let miniSearch = new MiniSearch({
           fields: ["text0.text", "text1.text", "text2.text", "text3.text"],
             storeFields: ["p", "text0", "text1", "text2", "text3"]
         });

         miniSearch.addAll(flattenedData);

        $searchInput.addEventListener("input", (event) => {
          const query = $searchInput.value;
          const results = (query.length > 0) ? getSearchResults(query) : [];
          renderSearchResults(results);
          const suggestions = (query.length > 0) ? getSuggestions(query) : [];
          renderSuggestions(suggestions);
        });

        const getSearchResults = (query) => {
            return miniSearch.search(query);
        };

       const getSuggestions = (query) => {
         return miniSearch.autoSuggest(query, { boost: { "text0.text": 5, "text1.text": 4, "text2.text": 3, "text3.text": 2 } });
       };

        const renderSearchResults = (results) => {
            $results.innerHTML = ""; // Clear previous results
            results.forEach(result => {
              const li = document.createElement('li');
              let displayedText = "";
                if (result.text0 && result.text0.text && result.text0.index != null) {
                  displayedText = result.text0.text
                }
                if (result.text1 && result.text1.text && result.text1.index != null) {
                    displayedText =  result.text1.text;
                }
                if (result.text2 && result.text2.text && result.text2.index != null) {
                    displayedText =  result.text2.text;
                }
                if (result.text3 && result.text3.text && result.text3.index != null) {
                   displayedText =  result.text3.text
                }
              li.textContent = displayedText;
              $results.appendChild(li);
            });
        };

        const renderSuggestions = (suggestions) => {
            $suggestions.innerHTML = ""; // Clear previous suggestions
            suggestions.forEach(suggestion => {
                const li = document.createElement('li');
                li.textContent = suggestion.suggestion;
                $suggestions.appendChild(li);
            });
        };

    </script>
</body>
</html>
