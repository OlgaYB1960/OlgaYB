<!DOCTYPE html>
<html>
<head>
<title>MiniSearch Example</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/minisearch@7.1.0/dist/umd/index.min.js"></script>
<style>
  #results {
    list-style: none;
    padding: 0;
  }
  #results li {
    margin-bottom: 5px;
  }
</style>
</head>
<body>
<input type="text" class="Search" placeholder="Search...">
<ul id="results"></ul>

<script>
const $searchInput = document.querySelector(".Search");
const $results = document.getElementById("results");

const arr = [
  {
    "id": 123456,
    "p": [
      { "b": { "span": { "#text": "Руководство пользователя по работе в Личном кабинете (ЛК)" } } },
      { "a": { "strong": { "span": { "#text": "1. Первичный вход в личный кабинет" } } } },
      { "a": { "strong": { "span": { "#text": "2. Настройка ЭЦП" } } } },
      { "a": { "strong": { "span": { "#text": "3. Работа с поручениями в ЛК" } } } }
    ]
  }
];

let miniSearch = new MiniSearch({
  fields: ['p.0.b.span.#text','p.1.a.strong.span.#text','p.2.a.strong.span.#text','p.3.a.strong.span.#text','p.4.a.strong.span.#text','p.5.a.strong.span.#text','p.6.a.strong.span.#text'],
  extractField: (doc, fieldName) => {
    const parts = fieldName.split(".");
    let value = doc;
    for (const part of parts) {
      if (value && value.hasOwnProperty(part)) {
        value = value[part];
      } else {
        return ""; // Handle missing fields gracefully
      }
      if (typeof value === 'object' && value.hasOwnProperty('#text')) {
        value = value['#text'];
      }
    }
    return value;
  }
});

miniSearch.addAll(arr);

$searchInput.addEventListener("input", (event) => {
  const query = $searchInput.value;
  const results = (query.length > 0) ? miniSearch.search(query) : []; //Simplified search call
  renderSearchResults(results);
});


const renderSearchResults = (results) => {
  $results.innerHTML = '';
  results.forEach(result => {
    const li = document.createElement('li');
    li.textContent = result.p.map(item => item.a?.strong?.span?.['#text'] || item.b?.span?.['#text']).join('\n');
    $results.appendChild(li);
  });
};

</script>
</body>
</html>
